check_twamp-light
=================

An [MRTG](https://oss.oetiker.ch/mrtg/) plugin for measuring network latency using TWAMP Light reflectors.

Example
-------

This is what a graph, generated by MRTG from this plugins data looks like:

![TWAMP light screensthot](https://gitlab.com/tickelton/monitoring-plugins/raw/master/check_twamp-light/screenshots/twl-html.png)


Building the plugin
-------------------

The only thing required to build this plugin is a working C compiler.

To build the plugin just run:
```
make
```

The default compiler for this project is [Clang](https://clang.llvm.org/). If you want to use a different compiler instead, e.g. [GCC](https://gcc.gnu.org/), that can be accomplished by setting the `CC` and `LD` make variables:
```
make CC=gcc LD=gcc
```

Installation
------------

Running `make` will output the compiled plugin binary to **build/check_twamp-light**.

There is no additional installation required. This binary can then be placed in any convenient location where your chosen monitoring tool will be able to find it, e.g. */usr/local/bin*.


Configuration
-------------

An example congiguration file for **MRTG** can be found at *config/twamp-light.cfg*.

The only mandatory command line argument to **check_twamp-light** is the host name or IP address of the TWAMP Light reflector to connect to. Optionally the UDP port to use can be specified with the *-p* flag. The default port is *862*.

**check_twamp-light** will return 4 lines of output:

* outbound latency in ms
* inbound latency in ms
* a blank line (where MRTG would optionaly expect the uptime of the target host)
* the host name or IP address of the target host

Testing the plugin
------------------

A minimal dummy TWAMP Light reflector can be built from the **dummy-reflector** directory:
```
cd dummy-reflector/
make
```

This dummy reflector can be used to test the plugin and simulate network latency.

An example use case would be as follows.

Run the dummy reflector on port 8001, simulating an receive latency of 10ms and an send latency of 20ms:
```
./dummy-reflector -p 8001 -r 10000 -s 10000
```

Run the plugin to poll the dummy reflector running on localhost:
```
./check_twamp-light -p 8001 127.0.0.1
10.20
20.15

127.0.0.1
```

License
-------

**check_twamp-ligth** is released under the terms of the MIT license.  
See **LICENSE** in the root of this repository for the full license text.
